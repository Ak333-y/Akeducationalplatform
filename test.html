<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>テスト - Study App</title>
  <script src="questions.js"></script>
  <style>
    body { font-family: "Noto Sans JP", sans-serif; text-align: center; background: #fafafa; }
    .question { margin: 30px; font-size: 20px; }
    input { padding: 10px; border-radius: 8px; border: 1px solid #ccc; }
    button { padding: 10px 15px; border-radius: 8px; border: none; background: #007bff; color: white; cursor: pointer; margin-left: 10px; }
  </style>
</head>
<body>
  <h2>テスト</h2>
  <div class="question" id="question"></div>
  <input id="answer" placeholder="答えを入力">
  <button onclick="checkAnswer()">送信</button>
  <div id="result"></div>

  <script>
    const user = localStorage.getItem("currentUser");
    const testType = localStorage.getItem("testType");
    const allQuestions = questionSets[testType];
    const questions = allQuestions.sort(() => 0.5 - Math.random()).slice(0, 10);

    let current = 0;
    let score = 0;

    function showQuestion() {
      document.getElementById("question").textContent =
        `第${current+1}問：${questions[current].q}`;
      document.getElementById("answer").value = "";
      document.getElementById("result").textContent = "";
    }

    function checkAnswer() {
      const ans = document.getElementById("answer").value.trim();
      const correct = questions[current].a;
      if (ans === correct) {
        score += questions[current].points;
        document.getElementById("result").textContent = "⭕ 正解！";
      } else {
        document.getElementById("result").textContent = `❌ 不正解（正答：${correct}）`;
      }

      current++;
      if (current < questions.length) {
        setTimeout(showQuestion, 1000);
      } else {
        savePoints();
      }
    }

    function savePoints() {
      const userPoints = JSON.parse(localStorage.getItem("userPoints")) || {};
      if (!userPoints[user]) userPoints[user] = 0;
      userPoints[user] += score;
      localStorage.setItem("userPoints", JSON.stringify(userPoints));

      document.body.innerHTML = `
        <h2>終了！得点：${score}点</h2>
        <p>累計ポイント：${userPoints[user]} pt</p>
        <button onclick="window.location.href='menu.html'">メニューに戻る</button>
      `;
    }

    showQuestion();
  </script>
</body>
</html>
